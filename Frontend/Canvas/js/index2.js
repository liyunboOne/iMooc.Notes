{
	let json = [
		{"title":"白甜", "url":"http://img.mb.moko.cc/2017-08-31/fb53ba97-d0a6-44d8-9b60-974b7eacd566.jpg"}, 
		{"title":"白甜", "url":"http://img.mb.moko.cc/2017-08-31/313c307b-b165-4574-9675-6e38918ff4d0.jpg"},
		{"title":"白甜", "url":"http://img.mb.moko.cc/2017-08-31/4a85ca5b-f5fd-4522-88a3-2c8287dc5318.jpg"},
		{"title":"时尚cosmo", "url":"http://img1qn.moko.cc/2017-09-01/70f1527e-f9b7-44ad-b5c9-ad1ec3071211.jpg"},
		{"title":"时尚cosmo", "url":"http://img1qn.moko.cc/2017-09-01/bfc53dd3-661e-43cd-8fc7-ba3e5a09d025.jpg"},
		{"title":"时尚cosmo", "url":"http://img1qn.moko.cc/2017-09-01/046daa19-4b65-4a47-a510-a2e7335da710.jpg"},
		{"title":"时尚cosmo", "url":"http://img1qn.moko.cc/2017-09-01/aa838ba6-dc51-4236-8b5c-cf46637dc138.jpg"},
		{"title":"（ok精彩）马思纯", "url":"http://img1qn.moko.cc/2017-09-01/ca6be013-78d4-4f3e-adbe-36595f0f77be.jpg"},
		{"title":"（ok精彩）马思纯", "url":"http://img1qn.moko.cc/2017-09-01/8a46366b-9406-4cdf-907b-47bc5703482c.jpg"},
		{"title":"广告杂志", "url":"http://img1qn.moko.cc/2017-09-08/c7508f27-57d6-4e91-b104-5e7b49b29269.jpg"},
		{"title":"广告杂志", "url":"http://img1qn.moko.cc/2017-09-08/34a1e599-f3fc-427f-b860-4c5d0b492922.jpg"},
		{"title":"广告杂志", "url":"http://img1qn.moko.cc/2017-09-08/4df02d0d-5995-4e53-8317-01f5fde52372.jpg"},
		{"title":"林依晨", "url":"http://img1qn.moko.cc/2017-09-06/f6f7a345-d6f8-4e75-8011-981c1a36404a.jpg"},
		{"title":"林依晨", "url":"http://img1qn.moko.cc/2017-09-06/f2d532d1-dbe7-44f2-95d0-86da7fddbbed.jpg"},
		{"title":"林依晨", "url":"http://img1qn.moko.cc/2017-09-06/7e675c02-1c34-4c55-aee7-44f418d49b36.jpg"},
		{"title":"九州梦", "url":"http://image17-c.poco.cn/mypoco/myphoto/20170825/09/6654656420170825092530040_640.jpg"},
		{"title":"九州梦", "url":"http://image17-c.poco.cn/mypoco/myphoto/20170825/09/6654656420170825092702063_640.jpg"},
		{"title":"九州梦", "url":"http://image17-c.poco.cn/mypoco/myphoto/20170825/09/6654656420170825092555013_640.jpg"},
		{"title":"Oneday", "url":"http://image13-c.poco.cn/mypoco/myphoto/20170815/21/5274901820170815210339032_640.jpg"},
		{"title":"Oneday", "url":"http://image13-c.poco.cn/mypoco/myphoto/20170815/21/5274901820170815211019066_640.jpg"},
		{"title":"Oneday", "url":"http://image13-c.poco.cn/mypoco/myphoto/20170815/21/5274901820170815210717039_640.jpg"},
		{"title":"Oneday", "url":"http://image13-c.poco.cn/mypoco/myphoto/20170815/21/5274901820170815210813067_640.jpg"},
		{"title":"小岛漫步", "url":"http://image17-c.poco.cn/mypoco/myphoto/20170831/17/17467238720170831170545043_640.jpg"},
		{"title":"小岛漫步", "url":"http://image17-c.poco.cn/mypoco/myphoto/20170831/17/17467238720170831170634016_640.jpg"},
		{"title":"小岛漫步", "url":"http://image17-c.poco.cn/mypoco/myphoto/20170831/17/17467238720170831170641083_640.jpg"},
		{"title":"小岛漫步", "url":"http://image17-c.poco.cn/mypoco/myphoto/20170831/17/17467238720170831170721021_640.jpg"},
		{"title":"｛夏光。｝", "url":"http://image17-c.poco.cn/mypoco/myphoto/20170907/11/17831018620170907113837085_640.jpg"},
		{"title":"｛夏光。｝", "url":"http://image17-c.poco.cn/mypoco/myphoto/20170907/11/17831018620170907113900074_640.jpg"},
		{"title":"#街拍", "url":"http://img.mb.moko.cc/2017-08-31/b85a8cc9-0766-4da8-a629-2406dd35e117.jpg"},
		{"title":"#街拍", "url":"http://img.mb.moko.cc/2017-08-31/9b41d810-c67b-4a90-a91b-395fd50be0c5.jpg"},
		{"title":"《楚乔传》淳儿公主 艺人拍摄-李沁", "url":"http://img1qn.moko.cc/2017-08-16/73f0ffae-8114-4a39-a0ee-f90ff6d1a157.jpg"},
		{"title":"《楚乔传》淳儿公主 艺人拍摄-李沁", "url":"http://img1qn.moko.cc/2017-08-16/5869ca57-8857-4f1b-8ae0-61eaab0e739a.jpg"},
		{"title":"新娘Brides 陈乔恩", "url":"http://img1qn.moko.cc/2017-09-12/33d22fb7-34e1-489c-93ba-ee94f97e120a.jpg"},
		{"title":"新娘Brides 陈乔恩", "url":"http://img1qn.moko.cc/2017-09-12/5fa56e28-a449-4ef1-ae24-f9fedd25acb7.jpg"},
		{"title":"新娘Brides 陈乔恩", "url":"http://img1qn.moko.cc/2017-09-12/7cd5ca6c-cec0-48b6-9251-b744bbd80f98.jpg"},
		{"title":"本地照片", "url":"../images/1.jpg"},
		{"title":"本地照片", "url":"../images/2.jpg"},
		{"title":"本地照片", "url":"../images/4.jpg"},
		{"title":"本地照片", "url":"../images/5.JPG"},
		{"title":"本地照片", "url":"../images/e0f39278-f0f3-4e85-8eab-69ab725ac73d.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201501/5/A1224931484.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201608/31/2391726453.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201608/31/9A91726256.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201608/31/CF91726114.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201608/31/2D91726702.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201608/31/CE91726982.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201608/31/C791726811.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201608/31/4091726655.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201501/5/FA224931272.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201501/5/25224931924.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201608/31/FC91727815.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201609/15/22194554883.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201609/15/48194555752.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201609/15/84195228316.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201609/15/B2195228865.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201609/15/17195229395.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201608/31/AD91727585.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201608/31/2A91727990.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201608/31/1B91727736.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201607/10/F720444235.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201607/10/8420444528.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201608/9/7594334124.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201609/19/CE182150400.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201609/19/B6182150568.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201609/11/0B215358118.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201609/11/89215358933.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201709/3/51205942242.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201709/3/D4205943918.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201709/3/50205943631.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201709/3/5E205943209.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201709/3/45205943306.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201709/3/46205943658.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201709/3/7D205943150.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201709/3/A0205944423.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201709/3/82205944860.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201709/3/06205944450.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201709/3/1A205945319.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201708/22/7C03450933.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201708/22/0003451890.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201707/7/B8215443653.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201707/7/00215443258.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201706/13/5B214732629.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201706/13/CA214732458.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201706/13/C5214733378.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201706/13/4F214733744.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201706/13/34214733815.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201706/13/51214734711.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201706/13/A2214734303.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/23/95155024790.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/D321483693.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/5C21483410.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/0421483115.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/B021484720.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/0621484264.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/B621484152.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/BE21484825.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/EE21484784.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/8921484684.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/3221484332.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/DE21484220.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/B321484105.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/3321484781.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/4B21484908.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/F321485818.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/8821485706.jpg"},
		{"title":"本地照片", "url":"http://www.xgyw.cc/uploadfile/201704/8/4C21485957.jpg"},
		// {"title":"本地照片", "url":""},
		// {"title":"本地照片", "url":""},
		// {"title":"本地照片", "url":""},
		// {"title":"本地照片", "url":""},
	]



	let $imgs_box = $('#imgs-box')

	init_page(json, $imgs_box)

	// $(window).resize(function(event) {
	// 	$imgs_box.empty().append(`<div id="vertical-img"></div>`)
	// 	setTimeout(init_page(json, $imgs_box), 600);
	// });

	function init_page(json, box) {
		let tpl = ''
		let i = 0
		let base_width = $('#imgs-box').innerWidth() / 6
		let WinWidth = $(document).width()
			// if (WinWidth < 900) {
			// 	base_width = $('#imgs-box').innerWidth() / 3
			// }
			// if (WinWidth < 500) {
			// 	base_width = $('#imgs-box').innerWidth() / 2
			// }
			
		for (let el of json) {
			tpl += `<a href="${el.url}" target="_blank"><canvas id="cvs_${i}"></canvas></a>`
			canvas_draw_img(el.url, i, base_width)
			i++
		}
		// box.prepend(tpl)
		box.append(tpl)
	}

	function canvas_draw_img(img_url, id, base_width) {
		
		let img = new Image();
		img.src = img_url
		img.onload = function(e) {
			this.raw_width = this.width
			this.raw_height = this.height

			this.scale = xround(this.width / this.height, 2)

			let canvas = document.getElementById(`cvs_${id}`)
			let context = canvas.getContext('2d')

			if (this.scale < 0.8) {
				canvas.width = base_width
				canvas.height = base_width*1.5

				if (this.scale < 0.67) {
					this.width = base_width
					this.height = this.height / (this.raw_width / base_width)
					this.sx = 0
					this.sy = (base_width*1.5 - this.height) / 2
				} else {
					this.height = base_width*1.5
					this.width = this.width / (this.raw_height / (base_width*1.5))
					this.sx = (base_width - this.width) / 2
					this.sy = 0
				}
			} else if (this.scale > 1.2){
				canvas.width = base_width*1.5
				canvas.height = base_width

				if (this.scale <= 1.5) {
					this.width = base_width*1.5
					this.height = this.height / (this.raw_width / (base_width*1.5))
					this.sx = 0
					this.sy = (base_width - this.height) / 2
				} else {
					this.height = base_width
					this.width = this.width / (this.raw_height / base_width)
					this.sy = 0
					this.sx = (base_width*1.5 - this.width) / 2
				}

			} else {
				canvas.width = canvas.height = base_width

				if (this.scale <= 1) {
					this.width = base_width
					this.height = this.height / (this.raw_width / base_width)
					this.sx = 0
					this.sy = (base_width - this.height) / 2
				} else {
					this.height = base_width
					this.width = this.width / (this.raw_height / base_width)
					this.sx = (base_width - this.width) / 2
					this.sy = 0
				}
			}
			context.drawImage(this, this.sx, this.sy, this.width, this.height)

			if (this.scale < 0.8) {
				$(`#cvs_${id}`).parent().remove().appendTo('#vertical-img')
			}
		}
	}

	// 保留几位bit小数的四舍五入函数
	function xround(num, bit){
		return Math.round(num * Math.pow(10, bit)) / Math.pow(10, bit)
	}

	// 简单的进度条 http://www.jq22.com/demo/NumberProgressBar-master/ http://www.jq22.com/jquery-info428
}
